<!DOCTYPE html><html prefix="og: https://ogp.me/ns#"lang=en><head><meta charset=UTF-8><meta name=viewport content="width=device-width, initial-scale=1.0"><meta name=keywords content=misc><meta name=description content="Installing Arch Linux With Full Disk Encryption"><meta name=author content=z2><meta property=og:title content="Installing Arch Linux With Full Disk Encryption"><meta property=og:type content=article><meta property=article:author content=https://github.com/z2-2z><meta property=og:site_name content="z2's blog"><meta property=og:url content=/2025/jul/30/installing-arch-linux-with-full-disk-encryption.html><meta property=og:description content="z2's blog"><meta property=og:image content=https://z2-2z.github.io/img/og-image.webp><meta property=og:image:width content=1280><meta property=og:image:height content=720><meta property=og:image:type content=image/png><meta name=twitter:card content=summary_large_image><meta name=twitter:site content=@_z2_2z_><meta name=twitter:creator content=@_z2_2z_><meta name=twitter:title content="Installing Arch Linux With Full Disk Encryption"><meta name=twitter:description content="z2's blog"><meta name=twitter:image content=https://z2-2z.github.io/img/og-image.webp><title>Installing Arch Linux With Full Disk Encryption</title><link rel=stylesheet href=/css/normalize.min.css><link rel=stylesheet href=/css/common.min.css><link rel=stylesheet href=/css/post.min.css><link href=/atom.xml type=application/atom+xml rel=alternate title="Atom feed"><style>@font-face{font-family:CodeFont;src:url(/fonts/code.woff2)format("woff2");font-weight:400;font-style:normal;font-display:block}</style><link rel=preload href=/css/atom-one-dark.min.css as=style onload=this.onload=null;this.rel='stylesheet'><noscript><link rel=stylesheet href=/css/atom-one-dark.min.css></noscript><script src=/js/highlight.min.js defer></script><script>document.addEventListener(`DOMContentLoaded`,()=>{hljs.highlightAll()})</script><script src=/js/hljs/plaintext.min.js defer></script><body><div id=container><div id=item><div id=headline><h1>Installing Arch Linux With Full Disk Encryption</h1><div id=metadata><div id=categories><span class=category><a href=/archive.html?#category%3A%22misc%22>#misc</a></span></div><div id=date><span>30 jul 2025</span></div></div></div><p>I recently bought a new laptop for travels and security-minded like I am, I wanted to set it up with full disk encryption. I could remember that years ago this was straight forward to do. Just follow the steps in the arch wiki and you're pretty much done. But, I had the great misfortune to discover that the installation guide has turned into a jungle of loosely connected pages. Especially for more complex setups like this it is easy to forget a step or miss an important detail. So, this post provides a linear and coherent guide how to setup full disk encryption.</p><br class=blank-line><p>Our setup will be as follows:<ol><li>Unencrypted EFI system partition with only a single GRUB EFI executable<li>One LUKS-encrypted LVM container, spanning the rest of the disk and containig all other partitions, such as swap, <code class="hljs code-inline">/boot</code> and data partitions</ol><h2><a href=#prerequisites><span id=prerequisites>Prerequisites</span></a></h2><p>Before you continue with the guide, make sure that you start with the normal installation instructions first <span class=quote>[<a href=#reference-1>1</a>]</span>. When you get to step "1.9 Partition the disks", hop over to this page.<h2><a href=#create-partitions><span id=create-partitions>Create Partitions</span></a></h2><p>We will create a GPT partition table with two partitions, an EFI system partition and a "Linux LUKS" partition. For that, we use <code class="hljs code-inline">gdisk</code>. Replace <code class="hljs code-inline">&LTdevice></code> with your hard disk, like <code class="hljs code-inline">/dev/sda</code>. <br class=blank-line><pre class=code-block><code class="hljs language-plaintext">$ gdisk &LTdevice>
</code></pre><br class=blank-line><p>Create a new partition table: <br class=blank-line><pre class=code-block><code class="hljs language-plaintext">o
</code></pre><br class=blank-line><p>Create an EFI system partition: <br class=blank-line><pre class=code-block><code class="hljs language-plaintext">n
1
(default)
+1G
ef00
</code></pre><br class=blank-line><p>Create a Linux LUKS partition: <br class=blank-line><pre class=code-block><code class="hljs language-plaintext">n
2
(default)
(default)
8309
</code></pre><br class=blank-line><p>And save the table to disk: <br class=blank-line><pre class=code-block><code class="hljs language-plaintext">w
</code></pre><h2><a href=#format-partitions><span id=format-partitions>Format Partitions</span></a></h2><p>Make the EFI system partition FAT32, where <code class="hljs code-inline">&LTdevice>1</code> stands for e.g. <code class="hljs code-inline">/dev/sda1</code> depending on your hard disk: <br class=blank-line><pre class=code-block><code class="hljs language-plaintext">$ mkfs.fat -F32 &LTdevice>1
</code></pre><br class=blank-line><p>Make the second partition a LUKS container: <br class=blank-line><pre class=code-block><code class="hljs language-plaintext">$ cryptsetup luksFormat --pbkdf pbkdf2 -i 10000 &LTdevice>2
</code></pre><h2><a href=#create-the-encrypted-volume><span id=create-the-encrypted-volume>Create the Encrypted Volume</span></a></h2><p>Start by opening the encrypted partition as <code class="hljs code-inline">cryptlvm</code>: <br class=blank-line><pre class=code-block><code class="hljs language-plaintext">$ cryptsetup open &LTdevice>2 cryptlvm
</code></pre><br class=blank-line><p>Create the volume group <code class="hljs code-inline">MyVolGroup</code>: <br class=blank-line><pre class=code-block><code class="hljs language-plaintext">$ pvcreate /dev/mapper/cryptlvm
$ vgcreate MyVolGroup /dev/mapper/cryptlvm
</code></pre><br class=blank-line><p>Create your unencrypted partition layout. I decided to go with two partitions: swap and root. <br class=blank-line><pre class=code-block><code class="hljs language-plaintext">$ lvcreate -L 16G -n swap MyVolGroup
$ lvcreate -l 100%FREE -n root MyVolGroup
$ lvreduce -L -256M MyVolGroup/root
</code></pre><br class=blank-line><p>Turn the partitions into your desired filesystems: <br class=blank-line><pre class=code-block><code class="hljs language-plaintext">$ mkswap /dev/MyVolGroup/swap
$ mkfs.ext4 /dev/MyVolGroup/root
</code></pre><h2><a href=#mount-the-partitions><span id=mount-the-partitions>Mount the Partitions</span></a></h2><p>Then, mount everything and continue with the installation instructions <span class=quote>[<a href=#reference-1>1</a>]</span> in chapter "2 Installation": <br class=blank-line><pre class=code-block><code class="hljs language-plaintext">$ mount /dev/MyVolGroup/root /mnt
$ swapon /dev/MyVolGroup/swap
$ mount --mkdir &LTdevice>1 /mnt/efi
</code></pre><br class=blank-line><p>Once you have gotten to "3.6 Initramfs", change back again to this page.<h2><a href=#configuring-initramfs><span id=configuring-initramfs>Configuring Initramfs</span></a></h2><p>Add the following hooks to <code class="hljs code-inline">/etc/mkinitcpio.conf</code>: <br class=blank-line><pre class=code-block><code class="hljs language-plaintext">HOOKS=(... encrypt lvm2 filesystems fsck)
</code></pre><br class=blank-line><p>and run <br class=blank-line><pre class=code-block><code class="hljs language-plaintext">$ mkinitcpio -P
</code></pre><h2><a href=#configuring-grub><span id=configuring-grub>Configuring GRUB</span></a></h2><p>In <code class="hljs code-inline">/etc/default/grub</code> uncomment <br class=blank-line><pre class=code-block><code class="hljs language-plaintext">GRUB_ENABLE_CRYPTODISK=y
</code></pre><br class=blank-line><p>and add the kernel parameters <br class=blank-line><pre class=code-block><code class="hljs language-plaintext">GRUB_CMDLINE_LINUX_DEFAULT="... cryptdevice=UUID=&LTdevice-uuid>:cryptlvm root=/dev/MyVolGroup/root"
</code></pre><br class=blank-line><p><code class="hljs code-inline">&LTdevice-uuid></code> is the UUID of the LUKS container partition <code class="hljs code-inline">&LTdevice>2</code>. You can get it via <code class="hljs code-inline">lsblk -f</code>. Then, run <br class=blank-line><pre class=code-block><code class="hljs language-plaintext">$ grub-install --target=x86_64-efi --efi-directory=/efi --bootloader-id=GRUB --recheck
$ grub-mkconfig -o /boot/grub/grub.cfg
</code></pre><h2><a href=#configuring-the-os><span id=configuring-the-os>Configuring the OS</span></a></h2><p>In order to access your unencrypted volume group you need to install the software that can do this: <br class=blank-line><pre class=code-block><code class="hljs language-plaintext">$ pacman -S lvm2
</code></pre><br class=blank-line><p>Then everything should be good to go. Don't forget to set your root password and reboot into the new environment.<h2><a href=#references><span id=references>References</span></a></h2><table id=citations><tr id=reference-1><td class=cite-number>[1]<td class=cite-source><a class=link href=https://wiki.archlinux.org/title/Installation_guide target=_blank>Installation guide - Arch Wiki</a></table><hr><div id=footer-meta><span id=footer-blog><a href=/>z2's blog</a></span></div><br></div></div>